<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<i>results are shown in the browser console</i>
</body>
<script  type='module' src="./pako_original.js"></script>
<script type="module">


    
import * as YPAKO  from './pako/Pako_full.js';
import {tester} from './pako/_testTools.js';


const samples = await tester.loadSamples();

tester.mainrun('Small input chunks', () => {

    tester.run('deflate 100b by 1b chunk', () => {
        const buf = tester.randomBuf(100);
        const deflated = YPAKO.Pako_Deflate.deflate(buf);
        tester.testChunk(buf, deflated, new pako.Deflate(), 1);
    });

    tester.run('deflate 20000b by 10b chunk', () => {
        const buf = tester.randomBuf(20000);
        const deflated = YPAKO.Pako_Deflate.deflate(buf);
        tester.testChunk(buf, deflated, new pako.Deflate(), 10);
    });

    tester.run('inflate 100b result by 1b chunk', () => {
        const buf = tester.randomBuf(100);
        const deflated = YPAKO.Pako_Deflate.deflate(buf);
        tester.testChunk(deflated, buf, new pako.Inflate(), 1);
    });

    tester.run('inflate 20000b result by 10b chunk', () => {
        const buf = tester.randomBuf(20000);
        const deflated = YPAKO.Pako_Deflate.deflate(buf);
        tester.testChunk(deflated, buf, new pako.Inflate(), 10);
    });

});


tester.mainrun('Dummy push (force end)', () => {

    tester.run('deflate end', () => {
        const data = samples["lorem_utf_100k"];

        const deflator = new YPAKO.Pako_Deflate();
        deflator.push(data);
        deflator.push([], true);

        tester.assertEqual(deflator.result, pako.deflate(data));
    });

    tester.run('inflate end', () => {
        const data = YPAKO.Pako_Deflate.deflate(samples["lorem_utf_100k"]);

        const inflator = new YPAKO.Pako_Inflate();
        inflator.push(data);

        tester.assertEqual(inflator.result, pako.inflate(data));
    });

});


tester.mainrun('Edge condition', () => {

    tester.run('should be ok on buffer border', () => {
        let i;
        const data = new Uint8Array(1024 * 16 + 1);

        for (i = 0; i < data.length; i++) {
            data[i] = Math.floor(Math.random() * 255.999);
        }

        const deflated = YPAKO.Pako_Deflate.deflate(data);

        const inflator = new YPAKO.Pako_Inflate();

        for (i = 0; i < deflated.length; i++) {
            inflator.push(deflated.subarray(i, i + 1), false);
            tester.assert(!inflator.err, 'Inflate failed with status ' + inflator.err);
        }

        inflator.push(new Uint8Array(0));

        tester.assert(!inflator.err, 'Inflate failed with status ' + inflator.err);
        tester.assertEqual(data, inflator.result);
    });

});
console.log("Done.")
/*-------------------------------------------*/


</script>

</html>

